@using DotAPicker.Models
@using DotAPicker.ViewModels
@model DotANoteViewModel<Tip>

@{
    ViewBag.Title = "Tip";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var signedIn = ((User)Session["user"])?.IsAuthenticated == true;
}

<link href="~/Content/chosen.css" rel="stylesheet" />
<link href="~/Content/filter-table.css" rel="stylesheet" />
<script src="~/Scripts/chosen.jquery.js"></script>
<script src="~/Scripts/filter-table.js"></script>

<h1>Tips</h1>

@if (signedIn)
{
    @Html.ActionLink("(new)", "Create", new { }, new { @class = "create-link", title = "New Tip" })
}

<div class="col-xs-12">
    <div class="col-xs-2">
        <input type="text" class="text-search" id="nameFilter" style="display:inline-block" onkeyup="filterFunction()" placeholder="Search hero or label name..." />
    </div>
    <div class="col-xs-3">
        <select multiple data-placeholder="Search by tip type" id="typeFilter" class="form-control" onchange="filterFunction()">
            @foreach (var option in TipType.Other.AsSelectList()) //a clumsy way of getting a list of values and display names
            {
                <option value="@option.Text">@option.Text</option>
            }
        </select>
    </div>
    <div class="col-xs-7">
        <input type="text" class="text-search" id="textFilter" style="display:inline-block" onkeyup="filterFunction()" placeholder="Search tip text..." />
    </div>
</div>

<div class="col-xs-12">
    <div class="data-row">
        <div class="header-cell col-xs-2" style="min-width: 175px">Subject Name</div>
        <div class="header-cell" style="display:none">Name Set</div>
        <div class="header-cell col-xs-1">Patch</div>
        <div class="header-cell col-xs-1">Type</div>
        <div class="header-cell col-xs-8">Text</div>
    </div>
    <div id="filterTable">
        @foreach (var tip in Model.Notes)
        {
            <div class="data-row">
                <div class="data-row-cell col-xs-2" style="min-width: 175px" id="heroName">
                    @tip.SubjectName
                    @if (signedIn)
                    {
                        <div class="link-padding">
                            @Html.ActionLink("(edit)", "Edit", new { id = tip.Id }, new { @class = "edit-link", title = "Edit Tip" })
                            @Html.ActionLink("(delete)", "Delete", new { id = tip.Id }, new { @class = "delete-link", title = "Delete Tip" })
                            @if (tip.Patch != Model.CurrentPatch)
                            {
                                <a class="upgrade-patch-link" href="/Tip/Upgrade/@tip.Id" title="Upgrade Tip (to latest patch)">
                                    <svg width="15px" height="15px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                        <path fill="#000000" d="M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z" />
                                    </svg>
                                </a>
                                
                            }
                        </div>
                    }
                </div>
                <div class="data-row-cell" style="display:none" id="nameValue">@tip.NameSet</div>
                <div class="data-row-cell col-xs-1" id="typeValue">@tip.Patch</div>
                <div class="data-row-cell col-xs-1" id="typeValue">
                    @Html.DisplayFor(m => m.Notes.First(t => t.Id == tip.Id).Type)
                </div>
                <div class="data-row-cell col-xs-8" id="textValue">@tip.Text</div>
            </div>
        }
    </div>
</div>

<script>
    $("#typeFilter").chosen({
        width: "300px"
    });

    var filterSet = [[
        "nameFilter",
        "text",
        "nameValue",
        "inner"
    ], [
        "typeFilter",
        "multi",
        "typeValue",
        "inner"
    ], [
        "textFilter",
        "text",
        "textValue",
        "inner"
    ]];
</script>